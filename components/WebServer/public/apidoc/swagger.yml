openapi: '3.0.0'
info:
  version: '1.0.0'
  title: 'Conversation manager API client'
  description: 'a tool for listening to, reading, editing and annotating a conversation transcript'
  termsOfService: https://doc.linto.ai/#/?id=gnu-affero-general-public-licence-v3
  contact:
    name: LINAGORA
    url: http://linto.ai
    email: contact@linto.ai
#servers:
host: localhost:8000
basePath: /
schemes:
 - https
paths:
  # /:
  #   get:
  #     security:
  #       - cookieAuth: []
  #     description: sdfasdaf
  #     responses: 
  #       '200':
  #         description: OK
  #       '401':
  #         description: Not authenticated
  #       '404':
  #         description: Page not found 
  /login: 
    post:
      tags:
        - "users"
      summary: Logs in a user and returns the authentication cookie
      requestBody:
        required: true
        description: A JSON object containing the username and password.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      # security: []    # no authentication
      responses:
        '200':
          description: 
            Successfully authenticated.
            The session ID is returned in a cookie named `JSESSIONID`. You need to include this cookie in subsequent requests.
          headers: 
            Set-Cookie:
              schema: 
                type: string
                example: JSESSIONID=abcde12345; Path=/; HttpOnly
        '400':
          description: 
        '404':
          description:
        default:
          description:
  /api/user: 
    post:
      tags:
        - "users"
      operationId: createUser
      summary: creates a user
      requestBody:
        required: true
        description: A JSON object containing the username and password.
        content:   
          application/json:
            schema: 
              type: object
              properties:
                userName: 
                  type: string
                password:
                  type: string
                email:
                  type: string
                  format: email
                # convoAccess:
                #   type: array
                #   items: 
                #     type: object 
                #     properties:
                #       conversationid:
                #         type: string 
                #       accessType:
                #         type: string
      responses:
        '201':
          description: user is successfully created
          schema:
            $ref: '#/components/schemas/User'
        '400':
          description: bad request error
          schema:
            $ref: '#components/schemas/Error'
  /api/user/{userid}:
    get: 
      tags:
        - "users"
      operationId: getUser
      summary: Gets a user by id
      description: gets a single user
      parameters:
        - in: path
          name: userid
          schema:
            type: string
          required: true
      responses:
        '200':
          description: json document 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: bad request error
          schema:
            $ref: '#components/schemas/Error'
    put:
      tags:
        - "users"
      summary: updates a user password
      description: Adds conversation(s) id to a user's accessedMeetings
      requestBody:
        required: true 
        description: A JSON object containing the user id and conversation id(s).
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                accessedMeetings:
                  type: array
                  items:
                    type: integer 
      responses:
        '200':
          description: Successfully updated.
        '400': 
          description: Invalid id supplied 
        '404':
          description: User not found 
    delete:
      tags:
        - "users"
      summary: deletes a user by id
      parameters:
        - in: path
          name: userid
          schema:
            type: string
          required: true
      responses:
        '200':
          description: json document 
        '400':
          description: bad request error
          schema:
            $ref: '#components/schemas/Error'
  /api/user/{userid}/addaccess/{conversationid}:
    patch:
      tags:
        - "users"
      operationId: updateUserAccess
      summary: gives a user access to conversation(s)
      requestBody:
        required: true
        description: A JSON object containing the conversationid and user rights
        content:   
          application/json:
            schema: 
              type: object
              properties:
                userId:
                  type: string
                convoId: 
                  type: string
                userRights:
                  type: string 
      responses:
        '201':
          description: successfully updated 
        '403':
          description: not authorized
        '404':
          description: not found
  /api/user/{userid}/removeaccess/{conversationid}: 
    patch:
      tags:
        - "users"
      summary: removes access to conversation(s) from a user

  /api/users: 
    get:
      tags:
        - "users"
      summary: gets all users 
      # requestBody:
      #   description:
      responses:
        '200':
          description: returns a list of users 
          content:
            application/json:
              schema:
                type: array 
                items:
                  $ref: '#/components/schemas/User'

  /api/conversations: 
    get:
      tags:
        - "conversations"
      summary: gets all conversations
      responses:
        '200':
          description: returns a list of conversations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Conversation'

  /api/conversations/{conversationids}:
    get:
      tags:
        - "conversations"
      summary: gets all conversations by ids in list of ids

  /api/conversation:
    post:
      tags: 
        - "conversations"
      summary: creates a new conversation base
      requestBody:
        required: true
        description: A JSON object containing the owner id and conversation name.
        content:   
          application/json:
            schema: 
              type: object
              properties:
                name: 
                  type: string
      responses:
        '201':
          description: conversation is successfully created 
          schema:
            $ref: '#/components/schemas/Conversation'
        links:
          updateUserConvoAccess:
            operationId: updateUserAccess
            parameters: 
              conversationid: ''
            # description: > 
            #   The conversation id value can be used to update 
        '400':
          description: bad request error
          schema:
            $ref: '#components/schemas/Error'

  /api/conversation/{conversationid}: 
    get: 
      tags:
        - "conversations"
      summary: gets a conversation by id 
    delete: 
      tags:
        - "conversations"
      summary: deletes conversation

  /api/conversation/{conversationid}/agenda:
    put:
      tags:
        - "conversations"
      summary: replaces (empty) agenda 
    patch:
      tags:
        - "conversations"
      summary: modifies conversation agenda

  /api/conversation/{conversationid}/summary:
    put:
      tags:
        - "conversations"
      summary: replaces (empty) summary 
    patch:
      tags:
        - "conversations"
      summary: modifies conversation summary 
  
  /api/conversation/{conversationid}/speakers:
    get:
      tags:
        - "conversation/speakers"
      summary: gets all speaker in a conversation
  
  /api/conversation/{conversationid}/speakers/{speakerid}:
    get:
      tags:
        - "conversation/speakers"
      summary: gets speaker name by speakerid
    patch:
      tags:
        - "conversation/speakers"
      summary: modifies (empty) speaker name
    delete:
      tags:
        - "conversation/speakers"
      summary: deletes speaker from conversation

  /api/conversation/{conversationid}/speakers/{speakerids}:
     put:
      tags: 
        - "conversation/speakers"
      summary: replaces speaker ids

  /api/conversation/{conversationid}/editmode:

  /api/conversation/{conversationid}/annotate:


components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: JSESSIONID

  # parameters:
  # requestBodies:
  # responses:
  # headers:
  # examples:
  # links:
  # callbacks:

  schemas:
    Error:
      type: object
      properties:
        status:
          type: string
    UserLogin:
      type: object
      properties:
        userName:
          type: string 
        password:
          type: string
          format: password 
          writeOnly: true
      required:
        - userName
        - password
    User:
      type: object
      properties:
        userid:
          type: string
          readOnly: true
        userName:
          type: string 
        email:
          type: string
          format: email
        convoAccess:
          type: array
          items: 
            type: object 
            properties:
              conversationid:
                type: string 
              accessType:
                type: string
        required:
          - userid
          - userName
          - convoAcess 
    Conversation:
      type: object
      properties:
        conversationid:
          type: string
        lastUpdated:
          type: string
          format: date-time
        startDatetime: 
          type: string
          format: date-time
        endDatetime:
          type: string
        location:
          type: string
        audio:
          type: string
          format: url
        rawTranscript:
          type: string
        locked:
          type: boolean
        users:
          type: array
          items:
            type: object
            properties:
              userid:
                type: string 
              accessType:
                type: string
        agenda:
          type: array
          items:
            type: string 
        speakers:
          type: object 
          properties:
            speakerid:
              type: string
            speakername:
              type: string
            audiosample:
              type: string
              format: mp3??
          required:
            - speakerid
        keywords:
          type: array
          items:
            type: string
        annotations:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            comment:
              type: string
        summary:
          type: string
        processedTranscript:
          type: array 
          items:
            type: object
            properties:
              turnid:
                type: string
              speakerid:
                type: string
              timeStamp:
                type: string
              text:
                type: array
                items:
                  type: object
                  properties:
                    wordid:
                      type: string
                    word:
                      type: string
                    timeStamp:
                      type: string
                  required:
                    - wordid
                    - word
            required:
              - turnid
              - speakerid
      required:
        - conversationid
        - rawTranscript
        - audio
security:
  - cookieAuth: []
